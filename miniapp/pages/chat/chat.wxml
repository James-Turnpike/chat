<view class="page">
  <view class="header" bindtap="scrollToBottom">
    <text class="title">Daze 聊天室</text>
    <text class="clear" bindtap="onClear">清屏</text>
  </view>
  <scroll-view class="messages" scroll-y="true" scroll-with-animation="true" scroll-into-view="{{lastId}}">
    <view wx:if="{{!connected}}" class="status-bar">
      <text>连接中...</text>
    </view>
    <view wx:if="{{messages.length === 0}}" class="empty-state">
      <text>暂无消息，快来聊聊吧~</text>
    </view>
    <block wx:for="{{messages}}" wx:key="id">
      <block wx:if="{{item.type === 'sep'}}">
        <view id="msg-{{item.id}}" class="day-sep"><text class="sep">{{item.label}}</text></view>
      </block>
      <block wx:else>
        <view id="msg-{{item.id}}" class="msg {{item.self ? 'self' : 'other'}}">
          <view class="avatar" style="background: {{item.avatarColor}}">{{item.avatarChar}}</view>
          <view class="content">
            <view class="nick">{{item.nick}}</view>
            <view class="bubble-row">
              <view class="bubble" bindlongpress="onCopy" data-text="{{item.text}}"><text>{{item.text}}</text></view>
              <text class="time">{{item.time}}</text>
            </view>
          </view>
        </view>
      </block>
    </block>
  </scroll-view>
  <view class="input-bar">
    <input
      class="input"
      type="text"
      placeholder="{{connected ? '输入消息（回车发送）...' : '正在连接...'}}"
      placeholder-class="placeholder"
      confirm-type="send"
      focus="{{focus}}"
      maxlength="500"
      value="{{inputValue}}"
      bindinput="onInput"
      bindconfirm="onSend"
    />
    <text class="counter {{counterLevel}}" wx:if="{{inputValue.length > 0}}">{{inputValue.length}}/500</text>
    <button class="send {{!inputValue || !connected ? 'disabled' : ''}}" bindtap="onSend" disabled="{{!inputValue || !connected}}">发送</button>
  </view>
</view>
